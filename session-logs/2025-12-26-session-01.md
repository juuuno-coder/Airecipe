# Session Log: 2025-12-26 01:00 (Integrated)

**Topic:** 컬렉션/좋아요 정상화, AI 기능 제거, 성능 튜닝 및 블라인드 쉐프 모드 구현 (통합 로그)

## 📊 요약 (Summary)

이번 세션에서는 서비스의 핵심 기능인 **컬렉션/좋아요의 데이터 무결성**을 확보하고, 사용자 경험을 저해하는 **속도 문제**를 해결했으며, 기획 방향 변경에 따라 **AI 생성 기능을 제거하고 '블라인드 쉐프' 모드를 도입**했습니다.

- [x] **데이터 표시 오류 해결 (RLS & Fetching):**
  - RLS(Row Level Security) 정책을 대폭 수정하여 컬렉션/좋아요/레시피의 조회 권한을 공개(`true`)로 설정.
  - FK(Foreign Key) 조인 실패 시에도 데이터를 볼 수 있도록 페칭 로직을 방어적으로 개선(2-step fetch -> Optimized Single Query).
- [x] **AI 기능 제거:**
  - 레시피 생성 페이지(`create/page.tsx`)에서 'AI 자동 생성' 탭 및 관련 로직 삭제.
  - 수동 입력 폼을 메인으로 배치하고 불필요한 복잡도 제거.
- [x] **속도 및 성능 최적화 (Critical Performance Tuning):**
  - **메인/상세 페이지:** ISR 캐싱(`revalidate = 60`) 적용으로 DB 부하 최소화 및 로딩 속도 비약적 향상.
  - **마이페이지:** 프로필/컬렉션/레시피 데이터 페칭을 직렬(`await` loop)에서 병렬(`Promise.all`)로 변경하여 로딩 시간 단축.
  - **UI 반응성:** '좋아요' 버튼에 **낙관적 UI(Optimistic UI)**를 적용하여 서버 응답 대기 없이 즉시 반응하도록 개선.
  - **DB 최적화:** `optimize_indexes.sql` 실행으로 주요 조회 컬럼 인덱싱 추가.
- [x] **UI 디자인 고도화:**
  - **상세 페이지:** 컨테이너 너비를 **1400px**로 확장하여 와이드 모니터 대응.
  - **이미지 비율:** 결과물 비교 및 단독 이미지를 **2:3 (Portrait)** 비율로 고정하여 시각적 안정감 확보.
  - **텍스트:** 버튼 깨짐 방지(`whitespace-nowrap`) 처리.
- [x] **신규 기능 구현:**
  - **블라인드 쉐프 모드:** 레시피 등록 시 익명(`is_anonymous`) 설정 기능 추가. 상세 페이지 및 목록에서 작성자명/아바타 마스킹 처리.
  - **소셜 회원가입:** 회원가입 페이지(`register/page.tsx`)에 카카오/구글 로그인 버튼 연동 및 UI 복구.

## 📝 상세 대화 및 작업 로그

### 1. 컬렉션 및 좋아요 기능 정상화 (Root Cause Fix)

> **사용자:** 컬렉션을 저장해도 목록에 안 뜨고, 좋아요도 상태가 이상하다. 저장된 게 없다고 나온다.
> **AI:** 원인이 DB의 RLS 정책이 너무 엄격(`auth.uid() = user_id`)하게 설정되어 있어, 남의 레시피나 공개된 데이터를 조회(`SELECT`)조차 못하는 상황임을 확인.
>
> - **조치 1 (RLS):** `fix_all_final.sql`을 작성하여 모든 주요 테이블(`recipes`, `collections`, `likes`, `profiles`)의 `SELECT` 정책을 `USING (true)`(전체 공개)로 변경. `INSERT`/`UPDATE`는 여전히 본인만 가능하도록 유지.
> - **조치 2 (Fetching):** `src/app/collection/[id]/page.tsx`에서 조인(`profiles` 등)이 실패해도 핵심 데이터(`recipes`)는 보여주도록 쿼리를 분리했다가, DB가 정상화된 후 최적화된 단일 쿼리로 재작성.

### 2. AI 기능 제거 및 레시피 생성 페이지 개편

> **사용자:** AI 자동 생성 탭을 아예 없애고 싶다. 수동 입력만 남겨달라.
> **AI:** `src/app/create/page.tsx` 대규모 리팩토링.
>
> - AI 생성 관련 상태(`taskDescription`, `targetModel` 등) 및 탭 컴포넌트 삭제.
> - '비포/애프터' 이미지 업로드 UI는 유지하되, 전체 폼을 간결한 수동 입력 방식으로 통일.

### 3. 사이트 속도 개선 (Extreme Optimization)

> **사용자:** 사이트가 너무 느리다. 잘 때까지 10가지 개선점을 도출하고 고쳐달라.
> **AI:** 10가지 로드맵 제안 후 핵심 3가지 즉시 적용.
>
> - **메인/상세 페이지:** `export const revalidate = 60;` 추가. 실시간성이 덜 중요한 페이지를 정적 캐싱하여 TTFB(Time To First Byte)를 획기적으로 낮춤.
> - **마이페이지:** `ProfilePage` 도입부의 순차적 `await` 문들을 `Promise.all([...])`로 묶어 병렬 실행. 네트워크 워터폴(Waterfall) 현상 제거.
> - **낙관적 UI:** `LikeButton` 클릭 시 `setLiked(!liked)`를 먼저 실행하고 백그라운드에서 API 요청. 사용자 체감 딜레이 0ms 달성.

### 4. 상세 페이지 디자인 정밀 튜닝

> **사용자:** 이미지 비율을 1:1, 1:2, 1:1.6, 2:3으로 계속 바꿔보자. 화면도 더 넓게(1400px) 해달라.
> **AI:** `src/app/recipe/[id]/page.tsx` 반복 수정.
>
> - **Width:** `max-w-7xl` (1280px) -> `max-w-[1400px]`로 최종 확정.
> - **Aspect Ratio:** 여러 시도 끝에 **`aspect-[2/3]`** (세로형 포트레이트)가 가장 적절하다고 판단하여 최종 적용.

### 5. 블라인드 쉐프 모드 & 소셜 기능 강화

> **사용자:** 회원가입 없이 글 쓰게 할까? 아니면 익명으로 할까? -> 소셜 가입은 유지하되 '블라인드' 모드를 넣자.
> **AI:**
>
> - **DB:** `recipes` 테이블에 `is_anonymous` (Boolean) 컬럼 추가 (`enable_anonymous_recipes.sql`).
> - **등록 화면:** '블라인드 쉐프 모드' 스위치 UI 추가 및 DB 연동.
> - **표시 화면:** 상세 페이지 및 카드(`recipe-card.tsx`)에서 `is_anonymous`일 경우 "Blind Chef", 아바타는 "?"로 표시. 작성자 본인에게는 "Blind Chef (Me)"로 구분.
> - **회원가입:** `register/page.tsx`가 누락되어 있던 소셜 로그인 버튼(구글/카카오)을 추가하고, 깨진 임포트 구문을 복구(`lucide-react`, UI 컴포넌트 등).

## 💡 인사이트 (Insights)

- **RLS의 이중성:** RLS는 보안의 핵심이지만, `SELECT` 정책을 잘 못 잠그면 "데이터는 있는데 안 보이는" 최악의 UX를 유발합니다. 커뮤니티성 서비스에서는 조회는 과감히 풀고 쓰기 권한만 제어하는 것이 초기 안정화에 유리합니다.
- **낙관적 UI의 힘:** 서버 속도를 물리적으로 높이는 것보다, UI 반응을 먼저 보여주는 것이 사용자에게 "빠르다"는 느낌을 훨씬 강하게 줍니다.
- **기획의 전환:** AI 레시피 서비스에서 AI 기능을 빼는 역설적인 결정이 오히려 '인간 vs 인간', '계급장 떼고 붙자'는 독창적인 '블라인드' 컨셉을 완성했습니다.
